
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>SORACOM LTE-M Enterprise Buttonを利用したハンズオン(持ち込みVer.)</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid=""></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="soracom-lte-m-enterprise-button-handson-byol"
                  title="SORACOM LTE-M Enterprise Buttonを利用したハンズオン(持ち込みVer.)"
                  environment="web"
                  feedback-link="">
    
      <google-codelab-step label="オンラインハンズオンを始める前に" duration="5">
        <h2 is-upgraded>前提</h2>
<p>このドキュメントを進めるにあたって、以下のデバイスが必要となります。</p>
<ul>
<li>SORACOM LTE-M Button for Enterprise (本ハンズオンではソラコムからの貸与となります)</li>
</ul>
<p>このドキュメントを進めるにあたって、以下のアカウントが必要となります。</p>
<ul>
<li>SORACOM</li>
<li>SAMユーザー</li>
<li>AWS</li>
</ul>
<p>このドキュメントを進めるにあたって、以下の知識が必要となります。</p>
<ul>
<li>AWS Lambda (Pythonのサンプルコード、モジュールは準備済)</li>
</ul>
<p>SORACOMのアカウントをお持ちでない方は <a href="https://users.soracom.io/ja-jp/guides/getting-started/create-account/" target="_blank">https://users.soracom.io/ja-jp/guides/getting-started/create-account/</a> から作成してください。<br>本ハンズオンではSAMユーザーでの操作する前提のテキストになっています。SAMユーザーの作成がまだの方は<a href="https://users.soracom.io/ja-jp/docs/sam/create-sam-user/" target="_blank">https://users.soracom.io/ja-jp/docs/sam/create-sam-user/</a> から作成してください。</p>
<p>AWSのアカウントをお持ちでない方は https://aws.amazon.com/jp/register-flow/ から作成してください。</p>
<h2 is-upgraded>構成図<br><img style="width: 601.70px" src="img/e9fdf5fbe94844dd.png"></h2>


      </google-codelab-step>
    
      <google-codelab-step label="ユーザーコンソールへのログイン手順" duration="1">
        <p>SORACOMユーザーコンソールへのログイン手順を解説します。<br></p>
<h2 is-upgraded>ユーザーコンソールへログインする</h2>
<p>SORACOM ユーザーコンソール(SAMユーザログイン) (https://console.soracom.io/#/sam_login?coverage_type=jp) へアクセスします。SAMユーザのログイン画面が表示されますので、ご自身のオペレーターID、SAMユーザー、パスワードを入力し [ログイン] ボタンをクリックしてください。<br></p>
<p class="image-container"><img style="width: 397.00px" src="img/6c47f50f2baa9001.png"></p>
<p>SAMユーザーが他要素認証設定済みの場合は、MFA認証コードを入力する画面に遷移します。設定済みのMFA認証コードを入力してください。<img style="width: 408.00px" src="img/9e0bdbf00d0c385c.png"></p>
<p>以下のような「SIM 管理」画面が表示されたらログイン完了です。</p>
<p class="image-container"><img style="width: 604.21px" src="img/231a64cf2d2f821.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="ガジェット設定        〜Harvest動作確認" duration="0">
        <p>ガジェット設定を行い、動作確認として、Enterprise Button(または仮想ボタン) をクリックした際に SORACOM Harvest に対してクリックタイプを保存する方法を解説します。</p>
<p class="image-container"><img style="width: 601.70px" src="https://lh4.googleusercontent.com/sM-TbywcjTGw7MY9HYeT7nKyVoBW-rG2X8cLT2m2CJDxdpqAmf_ofq43ZYzA31ZYLxgTBzkWDlbVpVWIlX79aKv9BIdH6mjusdHeNNb5NFwgYZHdf8xtqBLUA1v7kGauSX4azLpe"></p>
<h2 is-upgraded>ガジェット設定にて、グループを作成する。</h2>
<ol type="1" start="1">
<li>ユーザーコンソール(https://console.soracom.io/) の &#34;Menu&#34; から &#34;ガジェット管理&#34; の&#34;LTE-M Button for Enterprise/Plus&#34; をクリックします。<img style="width: 601.70px" src="https://lh6.googleusercontent.com/7OCXXDeA8aCHaA1bN8AxdEq2KJYDSDWdycnleofqu0_Z7A3W2bhRKrLrJSx2X_YBcYsYJ-f_NorMPA3-t9GPJm2w8AGamM0WslDZoFEuKyNJKu8oA62yKnjkAW1GeuUNU8LGMXUd"><br><img style="width: 278.50px" src="https://lh5.googleusercontent.com/QzPosfRlPjbFHm5j74-tAQZD7XyknzS2V-ablvaWj7YlrX1MC3YpUUUsP-4RUE9dpysg2Mzjxfq8AGWC_GJ5M3ELNpl8Cn6se8DRzVbS8VX83tmsJd_EHY2DpyxNDql9RDOo47Qd"></li>
<li>&#34;デバイスを追加&#34;ボタンをクリックします。</li>
</ol>
<p class="image-container"><img style="width: 601.70px" src="https://lh5.googleusercontent.com/U0C1QEaMV1eDXeRCaLjMMP8PGxZl_mnAoANwez0oUE1QEU5mOsk1JxTcJubONl1cP78xsALTI5ApxOcZ2vHVyhRZRPxRp3G2TIfNJ0II2FpmHWz6C4pYbOxgCobBWTTpAwdHqbfC"></p>
<ol type="1" start="3">
<li>今回使用するボタンが表示されているので、チェックを入れて、&#34;次へ : グループを選択&#34;をクリックします。<br>※もし、ボタン一覧に利用するボタンが表示されていない場合は、チューターにご連絡ください。<br><img style="width: 601.70px" src="https://lh4.googleusercontent.com/TmCBpGvN0pSAm5LkbNe1uarYJFDeZUDa1JyxbxgYGqGyElQNYKviyXDj9l9T3Sf5C0RgNkortkZ-NJKl7VYF5cBZXMG05wm1b68cIzMnV93pBQW5jlokqOhvuxcavXPYqDDaYKEI"></li>
<li>新規グループを作成 を選び、グループ名に任意の名前 (たとえば &#34;handson-button&#34;)を入力して、&#34;次へ : 設定を編集&#34; をクリックします。<br><img style="width: 601.70px" src="https://lh3.googleusercontent.com/h7cxHZmQfk8E0Q-xtdb2hzE1mcnDqxVXt_Gqj_M171XUci8TJHwj5yK8voMdnW7ZjcJC0W9kewPKCQgDYNyb2u1bXwkJXjEN6Hl78bf3zH7Rem91M6r7Ub4zO07SM5Q236N5LdNM"><br></li>
<li>可視化セクションの&#34;可視化を有効にする(SORACOM Harvest Data / Lagoon)&#34;と簡易位置測位機能セクションの&#34;位置情報を付与する(簡易位置測位機能)&#34;にチェックを入れて、画面下部の&#34;保存&#34;ボタンをクリックします。<br><img style="width: 601.70px" src="https://lh6.googleusercontent.com/JDs6Hr3a9SuypGaUmCMpZNixAdEqVSRluHvPkKmc8T_WpJS45VJ1OsC0MQNnbxE4FL_twka-9JfIlG7DJBE286os55RE0QDTmS8BKLtuT2r9a8FhfAGI2AojLbr8oI11bVXNKkRr"><br><br><img style="width: 601.70px" src="https://lh3.googleusercontent.com/5SK8InXIjpxqgR3LVxsAAjZnKbuM5jI5jAq-RQsT5tie_a8vsLFOfWECGhQuGTtLgMMJOxc5RTTBaTHbXa54r0kly33jA4VYcGeak8Jm8f0y4JfsPyW5hkTjOcpcMfDlTIQfzz7s"></li>
<li>設定完了のダイアログが出てくれば、完了です。&#34;デバイス一覧に戻る&#34;をクリックして、デバイス一覧画面に戻ります。<br><img style="width: 450.02px" src="https://lh4.googleusercontent.com/-CeEF8q-hJ1RcYePIwsblkZUvdOBjLAP0oi_u8Jd4IDalaszTppDXXkBkpIOYL78Chyj4S2xA3msyqYMUsSucKni1TdrO_dcGnmClZxVMyQ4j98uBB1ocw0cJ1Uttx5JlWvlzsOf"><br><br><img style="width: 302.00px" src="https://lh3.googleusercontent.com/AaxXTNiFUvfDNRq6S_V8XtBpc0wb-I3VxPNDJRX_oYmHzHtY3NyAvftkUv_PBtg-umIC01bG38HNLF7CTvHVklMJ_jrtoNLG95kPFWgeKk2QZEswq5A7ldTsRdIYIhan9jOctobR"></li>
<li>デバイス一覧にて、&#34;SIMグループを編集&#34;ボタンをクリックします。<br><img style="width: 601.70px" src="https://lh3.googleusercontent.com/bBB1Q2ZFdDESp4yQi2Sc_it-E3zRXLNuh0e9dyX2IXjFFtipSDSsApj48vj8xuhiLCwBFBbi8JtS35w4nVZaNzN8Jw-2VCXFTggfz-f5nuIJAdZUq4AJpyOpN3t81lMwwswF04uN"></li>
<li>作成したSIMグループの設定画面に移動しますので、SORACOM Air for セルラー設定 セクションで、<strong>簡易位置測位機能</strong>がON、<strong>バイナリーパーサー</strong>がONで、フォーマットに<strong>@button</strong>と入っていることを確認します。<br><img style="width: 601.70px" src="https://lh3.googleusercontent.com/BPWB0q0uROa8ri69aCnKwSDdPKznYJi7rbODsWszxjkO4-wMWv9a_n33Pl1GkQgjTead-UKRr9YCH7KTo70kL_JCXvY0nFRYxm3IjCMNvtBVa0EHNV6Ri3yHFJk8jcS2DsWmrphm"></li>
</ol>
<p class="image-container"><img style="width: 601.70px" src="https://lh5.googleusercontent.com/Ju3RhaH--yZk05kNpYTA_jcW7XybwpjTvy5oKjvDZyRH00TJmu7jlxTCS3Kb1gRyn3-nHl3hF9Ci93mrgjji-X6zAl_G3nKtJZRCQUVXfHk-Q8KyzgvJRyjOBm-fkvNTKSDdgMNR"></p>
<ol type="1" start="9">
<li>SORACOM Harvest Data 設定セクションにて、設定がONになっていることを確認します。<br><img style="width: 601.70px" src="https://lh6.googleusercontent.com/IYT4yQX4HZtQfxUwYFJK4vKeoEMI90CvcJoBuYgkQAcTiDoE_rdTXcYcCMq8k7vneoxWrOnfbxZpnwpGRKKp9wcNf6JvMbIYW-h7Pa05HWvGVrRYoOeeYKapK7ahCLjUj9ddqhIU"></li>
</ol>
<h2 is-upgraded>Enterprise Button を押して Harvest を確認する</h2>
<p>いよいよ Enterprise Button を押します。ボタンをクリックし、 LED がオレンジ色となり、数秒後に緑色となればデータの送信は成功です。</p>
<p class="image-container"><img style="width: 570.00px" src="https://lh4.googleusercontent.com/6Iyqhfal_5bRudQuafr9EMCTIJDV8_9VzC_-xfKCPhwJ1ftG2kyq_KO3gJy7Lms_uc6zgBBa7q0bNkyJl6GOtrlIRzHAldU2TS3dKDXLwV1uoGN1rKKRhaZUq0xQovxcQVG5qp4c"></p>
<p>Harvest 上のデータを以下の手順で確認します。</p>
<ol type="1" start="1">
<li>&#34;Menu&#34; から &#34;SIM 管理&#34; を選択します。<br><img style="width: 302.00px" src="https://lh3.googleusercontent.com/AaxXTNiFUvfDNRq6S_V8XtBpc0wb-I3VxPNDJRX_oYmHzHtY3NyAvftkUv_PBtg-umIC01bG38HNLF7CTvHVklMJ_jrtoNLG95kPFWgeKk2QZEswq5A7ldTsRdIYIhan9jOctobR"></li>
<li>Enterprise Button の SIM の左端にある チェックボックスを選択し、&#34;操作&#34; =&gt; &#34;データを確認&#34; を選択します。<img style="width: 601.70px" src="https://lh6.googleusercontent.com/QTORS3u9vWp6o4lO19sq4L4eqaGzuaYxVXzu7TKfN1zY1DcxRYS-xO7cj1ibBjFAZWrGjU5-fM27c-8WBETrCvEugMbREhkZKqVLStpgqOlijZ-wqo65L46o933wek-HWrtjgBXH"><br></li>
<li>&#34;データ&#34; 列にて、&#34;clickTypeName&#34; が &#34;SINGLE&#34; であることを確認します。<br><img style="width: 601.70px" src="https://lh4.googleusercontent.com/n_QUUhcRQTz-MNgrK-UnDWq7A33QfFU37FFO3_toqszF75NCEUtb1vgq0TkMBc0V_7VdNyTul7kpG43o2d1kBstlPeVo0ucH61c7-0UUVmGWSpOKcCQ8mqvgDrgoaJx0I26H0aHE"></li>
<li>マップピンアイコンを選択することで表示を地図に変更して、位置情報を確認します。左上の &#34;+&#34; や &#34;-&#34; でズームを調整できます。&#34;データ&#34; にも <code>$metadata.location</code> オブジェクトとしてで位置情報が入っています。<br><img style="width: 601.70px" src="https://lh6.googleusercontent.com/fVPzQo42It--3sRQTLrJP_ScDVunpFPSV5ZyzUcKaFJFOeCPmkWeyizsdx7pALxuAXVAPJtlcAYMQcWfmCp8mek_S5QuWgH6eRj5jPid-JzXgRgls20hlvPUaW2dQLuW180_nGbe"></li>
<li>Enterprise Button は以下 3 種類のクリックに対応しています。それぞれぜひ試してみてください。連続してデータの送信をしたい場合は Harvest の画面にて「自動更新」を &#34;ON&#34; にしてみてください。</li>
</ol>
<ul>
<li>シングル: 短く(1.2 秒未満) 1 回押す</li>
<li>ダブル: 2 秒以内にシングルクリックを 2 回行う</li>
<li>ロング: 1.2 秒以上押し続ける。</li>
</ul>
<p class="image-container"><img style="width: 601.70px" src="https://lh4.googleusercontent.com/JujX03J9Mu704Eaz0NztbntieBNL51fN6L5wRv0r1LMvRAwmKDeTE-K_sM9OCtvrzXHgLvaXCW-a8x0jLbBu7LG79Lpp4VENP2baEY4g5hXd6oVXqH-AcJiQakCQ-9kbfKoAXSFl"><img style="width: 601.70px" src="https://lh3.googleusercontent.com/FFhwXJzEFNS5DsbVXRsGyc3rckblgYKvuMETYSMr8GdpaM9AExfWB4Xf69th8HMYaSLKUXNR06QBg5d6iNoPLc0N2ip-kZHR8lFsGrLu_5zskI-_NIxEuARoRezO4bLhJq7lmPoB"></p>



      </google-codelab-step>
    
      <google-codelab-step label="SORACOM Funk設定〜動作確認" duration="0">
        <p>AWS LamdaとSORACOM Funkを設定し、ボタンクリックで、デバイスが動作させるところまでを解説します。</p>
<p>まず、利用するサービスについて解説します。</p>
<h2 is-upgraded>SORACOM Funkについて</h2>
<p>今回のハンズオンでは、「クラウドファンクションアダプタ SORACOM Funk」を用いてAWS LambdaのFunctionを呼び出します。</p>
<p>SORACOM Funkについて詳しくは以下の公式ページを参照ください。<br><br><a href="https://soracom.jp/services/funk/" target="_blank">https://soracom.jp/services/funk/</a></p>
<h3 is-upgraded>利用料金</h3>
<p>SORACOM Funk の課金体系は、リクエスト数に応じた従量課金です。初期費用、基本料金はかかりません。</p>
<ul>
<li>従量課金<br>1 リクエスト(*) あたり 0.00198円</li>
<li>無料利用枠<br>1アカウントあたり月間 50,000 リクエストまで毎月無料</li>
</ul>
<p>今回のハンズオンでは、ほとんどの方は無料枠の中でご利用いただけます。</p>
<h2 is-upgraded>AWS Lambdaについて</h2>
<p>今回のハンズオンでは、AWS Lambda(以下Lambda)を使ってデバイスにメッセージを送信します。</p>
<p>AWS Lambdaについては以下の公式ページを参照してください。</p>
<p><a href="https://aws.amazon.com/jp/lambda/" target="_blank">https://aws.amazon.com/jp/lambda/</a></p>
<p>Lambdaにコードをデプロイする方法はいくつかありますが、今回は運営が準備したコードをAWSコンソールから貼り付けてデプロイします。</p>
<h3 is-upgraded>利用料金</h3>
<p>Lambdaの利用料金は以下の公式ページをご覧ください。<br><br><a href="https://aws.amazon.com/jp/lambda/pricing/" target="_blank">https://aws.amazon.com/jp/lambda/pricing/</a></p>
<p>今回のハンズオンの内容は無料枠の中でご利用いただけます。翌月以降も費用が発生することはまずありませんが、不安な方はハンズオン終了後にリソースを削除してください。</p>
<h2 is-upgraded>AWS Lambdaの設定</h2>
<p>AWS Lambdaにデバイスへメッセージを送信するプログラムをデプロイします。</p>
<p>まず、<a href="https://console.aws.amazon.com/" target="_blank">AWSコンソール</a>にアクセスします。右上のリージョンが「バージニア北部」になっていない場合は、プルダウンから変更してください。<br><img style="width: 601.70px" src="https://lh4.googleusercontent.com/sRnjV349tmaf3v8j2C013vTUNAXagVHWlDMG-q9kpKHdMhZfcPpiw_htjE_zffUzrKB2VquNrhzmNt0oTglTNNU8vQIBHeIFqiPgJxZWmPdZiXkCN5Wjp2Gxxlbi9ks9gd-XrbxRuOcMcyL3bA"><br></p>
<p>検索窓に「Lambda」と入れてLambdaのコンソールにアクセスします。<br><img style="width: 601.70px" src="https://lh6.googleusercontent.com/ZKDOpDHcmqbSYcADhhg2_XVNQzteUJrWQjeXCDbrdwIBfqsdnJMHGEG5neXByt5_z2SOZQRHBHeh4dVQUzcVAZ62DrZORJWRGFP7M9h81Oqw4cjMnoSGOC3Y8xMudkwlAUfGVSJlxlC1pIqjlg"></p>
<h3 is-upgraded>関数の作成</h3>
<p>「関数の作成」を押し、新しい関数を作成します。<br><img style="width: 601.70px" src="https://lh6.googleusercontent.com/zpa5dkVIl5V-cBj9nRLic_v8cgXIsHQwcmy-S3ZsjtVziNN4gUqzmxaswRSUwvAVrXkb9I_urtlpVyMNPpaQa_8RhvVDIU4tfw4LrbWeJ8vb9UuU6pRFDXiuSheZA244TTwIDMcDnwnewENdQg"></p>
<p>関数のタイプで「一から作成」を選び、適当な関数名(例: soracom-techon-handson-20220408-role) と入力、ランタイムは「Python3.9」を選びます。それ以外の部分はデフォルトのままで「関数の作成」を押します。</p>
<p class="image-container"><img style="width: 601.70px" src="https://lh4.googleusercontent.com/xxB64ogikRGmrzwW6vCviFS2wDpBDfybJfIPvzroiEoBJK9d98oInhdWHvCGbqI8yIwK3bricFhJqvCPvCRIds7cvJzumyzty8UzdW21lkc9cj4ymIBfSY0uTkShzDbWZGekShnhKjMQZ0hTYA"></p>
<h3 is-upgraded>コードの編集</h3>
<p>コードソースに入っているデフォルトのコードを削除し、「<a href="https://raw.githubusercontent.com/soracomug/iot-button-handson-hybrid/master/src/keiganmotor_operator.py" target="_blank">keiganmotor_operator.py</a>」の内容をそのまま貼り付けます。</p>
<p>コード内の24行目の</p>
<p>「<strong>WHAT_YOUR_NAME = &#34;&#34; </strong>」<br>の<strong>&#34;&#34; </strong>内に、運営より指定された文字列を入力してください。</p>
<p>そして、「Deploy」ボタンを押してコードをデプロイします。</p>
<p class="image-container"><img style="width: 601.70px" src="https://lh5.googleusercontent.com/wKzW3n2Gh7vnebI9vToR4_5aVqRk3w-qUEqNPsX-j_VqNT4ZyZ51Ddt9mMzWQuJ-FaRxDmsEgVdj7m1J2oQ9QVxBjNrg_YXviHu3Rbp1b3LpShHj0_NlWAiwtgTbDkpxV1Q0ugxDjN7KpuPOtQ"></p>
<h3 is-upgraded>環境変数の設定</h3>
<p>「設定」→「環境変数」→「編集」を押し、このLambda関数の環境変数を設定します。<br><img style="width: 601.70px" src="https://lh4.googleusercontent.com/V-wvubYHzolBGc4EKH6d48KtnQnafyjG_oMJiCrW_TJVeFZIlY-Q5KXSxH0TRvcp4JcfdJaVyYsqUyXlyUByB8Gde3GvEtKGNqbRBm3ZtSbrM5Jssq0aGriUxMxhHAVFrVqXkN6A-nwKVItiuA"></p>
<p>「環境変数の追加」を4回押し、キーと値を入力する枠を4個作ります。そこに以下のキーと値を入れて、「保存」を押します。<br>・ DEST_REGION_NAME → 当日運営にお問い合わせください</p>
<p>・ DEST_ENDPOINT_URL → 当日運営にお問い合わせください</p>
<p>・ DEST_AWS_ACCESS_KEY_ID → 当日運営にお問い合わせください</p>
<p>・ DEST_AWS_SECRET_ACCESS_KEY → 当日運営にお問い合わせください</p>
<p class="image-container"><img style="width: 601.70px" src="https://lh3.googleusercontent.com/S50KGOfNRfDCdPVlGjcVFi0AKm-MtiBCqZ19_EK44-zraDcg03v0yNMNzg7VHkw1vHuQV7V58qvoojBZAt_iuKU6l5_LHLuTnQfgYKu2wnMXiiPLY0XZqPub0im7AexVFU1w-R-UlCzbxz1Twg"><br></p>
<h3 is-upgraded>タイムアウトの設定</h3>
<p>次にLambdaの実行時間(タイムアウト)を変更します。「一般設定」から「編集」を押します。<br><img style="width: 601.70px" src="https://lh4.googleusercontent.com/39tCKD21eUnERemc09T-TQhdSHokY-sWtBmNrrDenvv0mbJbIhIUM0HJIPdYxpuVxokdLlaGw4XsfXBld0iPg6oOAWYvxy3d6FtmrYPEpTvqP1xMcv_62GeE3myorPII0Ec0HrTqXK8McWtNIw"></p>
<p>デフォルトではタイムアウトが3秒になっているので、これを30秒に変更して「保存」を押します。<br><img style="width: 601.70px" src="https://lh3.googleusercontent.com/mxEHOZPFa_6xHQFuQvExXioNzWAvGjF-tJ7pYcYFvjQRuJ0XlyMmMccp2puUtJuJ7vROYoIvQ3NusDXgTJmE6W8jGBtwQApjVoMFM7hKb_zaNn5XCe0eaUju_3T4Y5hHfTb7urB12elrnsf-BA"><br></p>
<h3 is-upgraded>動作テスト</h3>
<p>保存できたら、動作テストを行います。</p>
<p>「テスト」を押し、テストイベントの名前に「test」と入力し、JSONが記載されている部分に以下のJSONを貼り付け、「変更を保存」を押します。<br></p>
<pre><code>{
    &#34;clickType&#34;:2,
    &#34;clickTypeName&#34;:&#34;SINGLE&#34;,
    &#34;batteryLevel&#34;:1,
    &#34;binaryParserEnabled&#34;:true
}</code></pre>
<p class="image-container"><img style="width: 601.70px" src="https://lh3.googleusercontent.com/wAMnrUJK0GMEv5oKB6FFQ982_tPg7R1ez7E8zKBIXQHz3YMvV7Rbx4GPHTWbSq0_SQ8DTWo9PBIvP6jKvoYXzmbOrruC3ipKlhfVuyMSR83BARjujIC4EYO677exc9pEWAkHRvrv05mTn1M-DA"></p>
<p>保存したら、「テスト」ボタンを押します。下図のように、「実行結果:成功」と出ていれば成功です。<br><img style="width: 601.70px" src="https://lh5.googleusercontent.com/oCqVko30F4mJEdLPhsnEuw2bsteR0eLA0fKuFGha2Q8oETj8IV7TgEt0PV2T7gGtoTG7oTaW0XPFsd8QEu9l1BDAcKT3r9Jqh06ze6pROREA9UtKspsFlNwtcncoxj7_p4im1_FFp5sZ3IbBrQ"><br></p>
<h3 is-upgraded>関数のARNの取得</h3>
<p>Lambdaのコンソールにて、「関数のARN」をコピーしておきます。</p>
<p class="image-container"><img style="width: 601.70px" src="https://lh3.googleusercontent.com/ucDbJYPHxxUwH-EjdtQY3sqWc8nfrLfvu9c3oUNwVAUXnNVPgXNagBrswkPFhdAKfVQUw2WTbZbRh98v258uMQR51NGt6yxYQjesN6vw0MPPTOPbOD26KOo8utbyKi3RIpmAjmGryNa5ZJeg_A"></p>
<h3 is-upgraded>トラブルシューティング</h3>
<p>設定がうまく進まないときにご覧ください。ここまでの作業が出来ている場合は次に進んでください。</p>
<p>・コードのコピペが崩れてる、全角スペースが入ってるなどコードの問題: ファイルは文字コード UTF-8になっていますので、ファイルを開いたエディタによってはShiftJISになってしまいますと、文字化けします。エディタの設定で、UTF-8で開き直してください。</p>
<p>・成功したけど、想定通りの動作じゃない。: keiganmotor_operator.pyの内容を貼り付けたあと、「Deploy」ボタンを押し忘れてますと、コードの変更が反映されず以下のような実行結果が表示されます。エディタ画面で「Deploy」ボタンを押してください。</p>
<p class="image-container"><img style="width: 601.70px" src="https://lh6.googleusercontent.com/2kJ0DeiVBM-q5g9TQFfIcbqt5nkDXPr6RXriKY28cd2NG5XaUwzMblxGPP2EzV1pWaQfXpOqBfurlVZP_opm3faXA0idGgUn-taOTAOkEkUm8o56UxH649HrnD_LICmRj4I70wx1qY9KsBeJGg"></p>
<p>・タイムアウトエラーが出る。: タイムアウト時間が初期設定の3秒のままだと、初回起動時にタイムアウトエラーになることがあります。タイムアウト時間の変更を行ってください。</p>
<h2 is-upgraded>IAM Roleの作成</h2>
<p>SORACOM FunkからAWS Lambdaを呼び出すための権限であるIAM Roleを作成します。</p>
<p>AWSのコンソールにて、検索窓に「IAM」と入力し、IAMのコンソールにアクセスします。</p>
<p class="image-container"><img style="width: 601.70px" src="https://lh6.googleusercontent.com/6-5MjkO7oDTC1SZFZZWtpOxM3r-4NLj5G2pUny2Cuv8VmV8z1-vIii5NGju51p5h1fUQF4v26QVEMjpHS__WH9CC_cyoXig1WE9jXSVfQf1m0-kKEOv1z6gI2lg3IcGVxyOi76J7huqQbtOKCQ"></p>
<h3 is-upgraded>IAM Roleの作成</h3>
<p>ロールを選択します。</p>
<p class="image-container"><img style="width: 601.70px" src="https://lh4.googleusercontent.com/VxxHrp3u40uR5NtdLGyH_3RUWzHsxYcqI5fcznx9v0m2BJQXkDl3bQWwMFHB9ZLexp6RQU-3_5xbLrvD3W7NWJgyTNo9YfM9zSGA9l6BZc6sU9kzmOwk0v3pePUA0phOSbJxT68JKnipYZX4_A"></p>
<p>ロールの作成をクリックします。</p>
<p class="image-container"><img style="width: 601.70px" src="https://lh5.googleusercontent.com/50CMn6ZYriSvJJhPmU-chFpLdeY35i2zF_jS5Ec6NiAzU93odbZbiUpKk6nVUXb4ARqvscjX6WdGY5cYBAPAT-933EliaTXnR2nVU-QvN_piJHKGeTivXCYXSF8J-uKK_6-FZdnhS0DI6W_NfA"></p>
<p>以下の項目を入力して、次へをクリックします。</p>
<table>
<tr><td colspan="1" rowspan="1"><p>信頼されたエンティティタイプ</p>
</td><td colspan="1" rowspan="1"><p>AWSアカウント</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>AWSアカウント</p>
</td><td colspan="1" rowspan="1"><p>別のAWSアカウント</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>アカウントID</p>
</td><td colspan="1" rowspan="1"><p>762707677580</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>オプション</p>
</td><td colspan="1" rowspan="1"><p>外部IDを要求する</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>外部ID</p>
</td><td colspan="1" rowspan="1"><p>任意(例: soracom-funk-roleid)</p>
</td></tr>
</table>
<p class="image-container"><img style="width: 601.70px" src="https://lh3.googleusercontent.com/f0BZ1jI6aFGlfaOpR-WnGIUcdzQDpIQ02gMooiISc0-Hn6Ns69DkJqBzjL7-d_TWlUfr_xEy-mSf_Jw6ucAjuKdmPYhYPASKpADtkvOsHeQw_05gkClZoloBwszTukwCb79CBR0sHAHqZnid3g"></p>
<p>「AWSLambdaRole」を検索してチェックを入れ、次へをクリックします。</p>
<p class="image-container"><img style="width: 601.70px" src="https://lh3.googleusercontent.com/K8eWqKEiNKNRXtDuX1LCJrHgv7ofjeRmxJTvIutYjFrlEH_4AUH_ombq7qMfVTtKVyIGC7EBptlC043yK8lbvd1aFAEW7313pUtnmkzJ__en_Tw1yVCZNnjU5YAyliSs2xx1BKB3JhLNze108A"></p>
<p>適当なロール名(例: soracom-techon-handson-20220408-role)を入力し、ロールを作成します。</p>
<p class="image-container"><img style="width: 601.70px" src="https://lh6.googleusercontent.com/Rbf9huQk-L48qLcVQ6xD8xBjsh2Bd90oWy15ANcm13U28LtQdtCfaetYyk4h8KmoRvAwnj0XqatTPXF3N06K-IC_-qi8UHu3oTCfalXDWwTQNHxeZoaUG8W6zY43VQdf46bglLxwrmC_PwcUsg"></p>
<h3 is-upgraded>ロールARNの取得</h3>
<p>作成したロールを表示します。</p>
<p class="image-container"><img style="width: 601.70px" src="https://lh3.googleusercontent.com/EcwuGW0FcW6nFDspYEXTd_k9ImSacy0FH_VjqjjhU1o1C_BwM9rV3wqTWq8iTh73Bxr4LDM_jwOI0zSJGn1-yPtu5Aordz_UmqkDdmP2Raij06s6z2jwX_maD7C9yU9Yw2QcTEpIV3riGqLuOw"></p>
<p>ロールのARNをコピーします。</p>
<p class="image-container"><img style="width: 601.70px" src="https://lh6.googleusercontent.com/oHFNXpou5x-adTSPhSXc1iZRGfc7JdPRpqJF9sBDmcv_0JIvnAqrmId7jQPt3ZZy6XsR4kZ6poWM5U0OanQZimZqOzZp4MwgL5IwtYYVjJA9IWl4QW2_zETR1bhPYDb7efHznKGNmbygPrJ5bw"></p>
<h2 is-upgraded>SORACOM認証情報の登録</h2>
<p>AWS Lambdaを呼び出すための認証情報の登録をします。</p>
<p><a href="https://console.soracom.io/#/login" target="_blank">SORACOM ユーザーコンソール</a>にログインします。</p>
<p>ユーザーコンソール右上のユーザー名をクリックし、「セキュリティ」を選択します。</p>
<p class="image-container"><img style="width: 601.70px" src="https://lh6.googleusercontent.com/U9rHQV5wXFQDe7ML7QecLOA0rF2v-ymzIzSBNBVIYVjNYwrBaZIb8A6U7aMrsZQuIw_MyBRGuBvkqTyRhZueSu1HHcFbmLOfgR6qj5phdQ57FNqvpCBicCwA57jJj0j5R899FHqyrrx97lr5MA"></p>
<p>認証情報ストアを開き、「認証情報を登録」をクリックします。</p>
<p class="image-container"><img style="width: 601.70px" src="https://lh5.googleusercontent.com/qiGErGLFiIa_wTQbH37_9it3YBPQkWeXlkh_aZFq8QPKPRBNgn8GHhNdNAB-uXX2mJfCnSANSwjO8BnH1k8JH71mZSA19MsFBcWrjIPcN9pa0nLmOlNGph2u-JvwdNrxqVVwtIsqLL96GZog4Q"></p>
<p>以下の情報を入力し、「登録」をクリックします。</p>
<table>
<tr><td colspan="1" rowspan="1"><p>認証情報ID</p>
</td><td colspan="1" rowspan="1"><p>任意(例: button-function)</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>種別</p>
</td><td colspan="1" rowspan="1"><p>AWS IAM ロール認証情報</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>ロールARN</p>
</td><td colspan="1" rowspan="1"><p>作成したIAM RoleのARN</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>外部ID</p>
</td><td colspan="1" rowspan="1"><p>作成したIAM Roleの外部ID(例: soracom-funk-roleid)</p>
</td></tr>
</table>
<p class="image-container"><img style="width: 601.70px" src="https://lh3.googleusercontent.com/f99Jr43JNL5lwquqCMIzKkfYtf8WmWwiV6jF4MEoFYe_e02pq0msb9TFPaxEQVIxarIMZjL1UwpmvjSADm-92n6RQJKTcUIYviyQqmFvNoCNeiqA4Xu--pgGNYJkEOCoi2P70jsJRaiD_C_s8Q"></p>
<h2 is-upgraded>SORACOM Funkの設定</h2>
<p>AWS Lambdaを呼び出すSORACOM Funkの設定をします。</p>
<p>所属させたグループ名をクリックし、SIMグループの設定画面に移動します。</p>
<p class="image-container"><img style="width: 601.70px" src="https://lh3.googleusercontent.com/Hm7XxWrac-z-FmFBy5T8XDKOktxI4N2bjtm6XFXFhbtHomstXtvN17seu-zqASbHywxTHjRqCA3l5-CWu85lhAC9jfUvZi-ecsSz63zFl6fqnpw5uYZqp9WEozt0YXvyT7bWxnzs3kbufQHbBg"></p>
<p>SORACOM Funkの設定を開き、以下の設定を入力して「保存」をクリックします。</p>
<table>
<tr><td colspan="1" rowspan="1"><p>設定</p>
</td><td colspan="1" rowspan="1"><p>ON</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>サービス</p>
</td><td colspan="1" rowspan="1"><p>AWS Lambda</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>関数のARN</p>
</td><td colspan="1" rowspan="1"><p>AWS Lambdaの関数のARN</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>認証情報</p>
</td><td colspan="1" rowspan="1"><p>作成した認証情報(例: button-function)</p>
</td></tr>
</table>
<p class="image-container"><img style="width: 601.70px" src="https://lh5.googleusercontent.com/4wEETGYtiksM0Is2-2Kyb54-sIp-Fr9FIQPGkTz5fuO9Bl--h01cPJ51Pg_zOKShJGXABxbS6wrO4-007VUG-DltsHYtWAZLcHlN3ISHeyeTINh4sxK0NILBstaWZ8jrRyEkEqawNkWlPt-PXw"></p>
<h2 is-upgraded>動作確認</h2>
<p>ボタンを押してみましょう。LEDが緑点灯すれば正常にリクエストできています。<br>デバイスが動作していると思うので、確認しましょう。<br><img style="width: 437.72px" src="https://lh4.googleusercontent.com/wt7AEAYv43Uxh1M3qrRelhH43gykbh2vtcVljkKWhMTs9N5mJ4ndw-kDh8XQAlAkPFK_p01DlgOnHyC2933dyeMBju74mRV4afr0kPoNx6L3LdS4kdEew_RLv5mexrG26lfrSAJGY9bAVft89Q"></p>



      </google-codelab-step>
    
      <google-codelab-step label="後片付け" duration="0">
        <p>後片付けの手順を解説します。</p>
<h2 is-upgraded>AWSリソース</h2>
<p>AWS上のリソースは、残っていても、課金されることはありませんが、不要な場合は、以下を行ってください。<br></p>
<ol type="1" start="1">
<li>AWS Lambda関数の削除</li>
<li>SORACOM Funk実行用のIAMロールの削除</li>
</ol>
<h2 is-upgraded>IoTボタンシュミレータの場合</h2>
<p><br>放置しておいても、課金が発生することはありませんが、後片付けを行います。</p>
<p>すでに今回のハンズオン以外で、Harvestなどのサービスをお使いの場合は、料金が発生しますので、不要の場合は削除を行ってください。</p>
<p>バーチャルSIMについても、アカウントに１つだけは無料で保持できますので、そのままでも問題ありません。1つ以上お持ちの方のみ、不要の場合は削除を行ってください。</p>
<h3 is-upgraded>WireGuardの削除</h3>
<p>OS標準のアンインストール方法で削除します。</p>
<h3 is-upgraded>SORACOM LTE-M Button for Enterpriseシミュレータの削除</h3>
<p>こちらもOS標準のアンインストール方法で削除します。</p>
<h3 is-upgraded>SIMグループの削除</h3>
<p>SIMグループを削除するには、紐づいているSIMグループを削除してから削除する必要があります。</p>
<ol type="1" start="1">
<li>SIMの紐付け解除は、SIMグループの登録と同じ手順で、SIMを選択して、SIMの所属グループ変更画面を表示します。そこで、新しい所属グループで[グループ解除]を選択して、登録すれば解除されます。</li>
</ol>
<p class="image-container"><img style="width: 500.50px" src="https://lh6.googleusercontent.com/CmwaXb5zxyd3XSplCTX5tN4fg_ve2Rnovv0y2s_JHGXAwWIMQhRwpGDS0jSyO1kStsE7mpPekrrnnfsxoz6vyhOB0dD6Nd8H-OeGWZT2ZRiBbFPdi1IFVJDatjGlo2sLaxmmcCwZ"></p>
<ol type="1" start="2">
<li>SIMグループの削除は、SIMグループ設定画面右上の[削除]をクリックします。</li>
</ol>
<p class="image-container"><img style="width: 503.50px" src="https://lh6.googleusercontent.com/4Ry3QpD6KDfgvEZPN86T3A6Tfw_b2buBuS7zO9aBrhxYV2lzH2XZwyz_YrEzQrAwUrXY54vNTH_7fN90sgTrT7MUAGGKR0Wmj-Glnv5tr7o_GycgY8M3Y3PZy8O6AyJSA-9UqslB"></p>
<ol type="1" start="3">
<li>問題なければそのまま[削除する]をクリックします。これで完了です。</li>
</ol>
<p class="image-container"><img style="width: 508.66px" src="https://lh4.googleusercontent.com/FoJW-WJ9sPW4QAIS0YhDywDTAQ9wYuj8uLP2m8u8AYE_xhuNMBkikZm88r4qEUe0OIk5-n6nFP_V_ilB2AR3-2a5D-RCcANRqKyvQEhkafOv0nlSbdlC_74S8s8y8UGc24dwnwSC"></p>
<p>なお、SIMの紐付けがあると、エラーになりますので、必ずSIMの紐付けを全部解除してから行ってください。</p>
<h3 is-upgraded>バーチャルSIMの削除(すでに1つ以上バーチャルSIMがある方のみ実施してください)</h3>
<ol type="1" start="1">
<li>バーチャルSIMの解約は、通常のSIMの解約と同じく、SIMを選択後、画面上部の[操作 ▼]をクリックし、[解約]をクリックします。</li>
</ol>
<p class="image-container"><img style="width: 343.69px" src="https://lh5.googleusercontent.com/NFESp8K8PovkBouLPqV_8mZwK0bQokIDAW7XFYLCpsRbGZSNIFmXxsk3p9KOQXe8N1qjkoVqRPth-bBUINe7LQHKWyhzpzrxihAP7QXuKSJ-_G8mvGkMVEsrK0LBKXQ44YHoZMPj"></p>
<ol type="1" start="2">
<li>問題なければ、そのまま[解約する]をクリックしてください。</li>
</ol>
<p class="image-container"><img style="width: 494.50px" src="https://lh3.googleusercontent.com/nhGsEdNrnejhZ6Pun3UWUqx9N4ZTEgXt6XJdRqwcBIvGuhA384y7ZWiG15sMf3iSGtoj6A8S3O_P6wSK2FBCo-KaXvxvBwRJ5-ITN04xYEiuoTwv4KLQh9WBiagHFuZvV0lWqu0y"></p>
<ol type="1" start="3">
<li>SIM一覧からバーチャルSIMがなくなっていればOKです。</li>
</ol>
<h3 is-upgraded>IAMロール認証情報の削除</h3>
<ol type="1" start="1">
<li>右上のメニューからセキュリティをクリックします。<br><img style="width: 246.50px" src="https://lh3.googleusercontent.com/zS9QIh8JZUVtcZNJrdpG6thrQsBZkzyGFpyBrJwJ5CM9CWqbEij93nykAZ46AlMSnOcOuw9nM6GXLN0dkIy6vJ3P2Rd_-rkwZ1m-P6mdQjRC6PyaCwTolbaFObU0MsKZp4dgwPAT"></li>
<li>セキュリティページの左メニューの認証情報ストアをクリックします。</li>
</ol>
<p class="image-container"><img style="width: 215.50px" src="https://lh5.googleusercontent.com/duVZEzEuOrMxBsCScRYUmr9ndGcC-Q7f3j7ukaCMAIQ9Z3pIYdKlls-SeFgX1E1qFfzZZ4uAuxaqek4xmeRfG-b1oRsmEuVWEugkQPXjrXVLZCox1Us-o_CW_7DYYo_sOlp5JtPc"></p>
<ol type="1" start="3">
<li>作成したIAMロールの右側にあるゴミ箱アイコンをクリックします。</li>
</ol>
<p class="image-container"><img style="width: 601.70px" src="https://lh5.googleusercontent.com/humFHUSR1ImmQr9_YqEJiX-YVPAgoLicg1YCiPXntESWCYHqv3kM16wlkImBWEXBJ2ybFBsS2ui8ijIKRUTJam3kPjcDrysN8pU4ZLfOIKjzH6VP3o4SxJuBrvuCp7LyL-5oqJa9"></p>
<ol type="1" start="4">
<li>ダイアログで削除ボタンをクリックします。これで削除完了です。<br><img style="width: 382.50px" src="https://lh6.googleusercontent.com/ABb_XYLC_FBeJklfkq5FUF-STwlTJ_MqnI2YRE-ehDlVnQLD8un73SxRFlPtkqmZ-UN30m4ehpHEo3kqV4jRixGonKNg936k6S9zVJguPq79GVs9Dq9M8Ndlz9kebwqgT27iKRAR"></li>
</ol>
<h2 is-upgraded>ボタン持ち込みの場合</h2>
<p>このままでも、課金が発生することはありませんが、後片付けを行います。<br>後片付け(IoTボタンシュミレータ)の手順にある、以下の手順のみ行ってください</p>
<ol type="1" start="1">
<li>SIMグループの削除</li>
<li>IAMロール認証情報の削除</li>
</ol>
<h2 is-upgraded>ボタン貸し出しの場合</h2>
<p>貸し出しの場合、SORACOMのコンソールからログアウトして、ボタンを運営メンバーにお返しください。</p>



      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
